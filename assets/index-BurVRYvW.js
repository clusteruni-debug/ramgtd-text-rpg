(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();function o(l,e,t){const s=document.createElement(l);return e&&(s.className=e),t&&(s.textContent=t),s}function m(l,e){return Math.floor(Math.random()*(e-l+1))+l}function y(l){return new Promise(e=>setTimeout(e,l))}function u(l){return JSON.parse(JSON.stringify(l))}function r(l,e,t){return Math.max(e,Math.min(t,l))}class g{constructor(){this._listeners={},this.state=this._createInitialState()}_createInitialState(){return{player:{name:"í”Œë ˆì´ì–´",level:1,exp:0,expToNext:100,hp:100,maxHp:100,mp:50,maxMp:50,attack:10,defense:5,speed:5},inventory:[],flags:{},currentScene:null,gold:0}}on(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}off(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(s=>s!==t))}emit(e,t){this._listeners[e]&&this._listeners[e].forEach(s=>s(t))}getStat(e){return this.state.player[e]}modifyStat(e,t){const s=this.state.player;e in s&&(s[e]+=t,e==="hp"&&(s.hp=r(s.hp,0,s.maxHp)),e==="mp"&&(s.mp=r(s.mp,0,s.maxMp)),this.emit("statChanged",{stat:e,value:s[e],delta:t}),e==="hp"&&s.hp<=0&&this.emit("playerDead",null))}setStat(e,t){const s=this.state.player;if(!(e in s))return;const i=s[e];s[e]=t,this.emit("statChanged",{stat:e,value:t,delta:t-i})}addExp(e){const t=this.state.player;for(t.exp+=e,this.emit("expGained",{amount:e,total:t.exp});t.exp>=t.expToNext;)t.exp-=t.expToNext,t.level+=1,t.expToNext=Math.floor(t.expToNext*1.5),t.maxHp+=10,t.maxMp+=5,t.hp=t.maxHp,t.mp=t.maxMp,t.attack+=2,t.defense+=1,t.speed+=1,this.emit("levelUp",{level:t.level})}addGold(e){this.state.gold+=e,this.emit("goldChanged",{gold:this.state.gold,delta:e})}addItem(e){const t=this.state.inventory.find(s=>s.id===e.id);t?t.quantity=(t.quantity||1)+(e.quantity||1):this.state.inventory.push({...e,quantity:e.quantity||1}),this.emit("inventoryChanged",{action:"add",item:e})}removeItem(e,t=1){const s=this.state.inventory.findIndex(n=>n.id===e);if(s===-1)return!1;const i=this.state.inventory[s];return i.quantity-=t,i.quantity<=0&&this.state.inventory.splice(s,1),this.emit("inventoryChanged",{action:"remove",itemId:e,quantity:t}),!0}hasItem(e){return this.state.inventory.some(t=>t.id===e)}getItem(e){return this.state.inventory.find(t=>t.id===e)||null}setFlag(e,t=!0){this.state.flags[e]=t,this.emit("flagChanged",{key:e,value:t})}getFlag(e){return this.state.flags[e]??null}hasFlag(e){return!!this.state.flags[e]}setCurrentScene(e){this.state.currentScene=e,this.emit("sceneChanged",{sceneId:e})}serialize(){return u(this.state)}deserialize(e){this.state=u(e),this.emit("stateLoaded",null)}reset(){this.state=this._createInitialState(),this.emit("stateReset",null)}}class v{constructor(e){this.state=e,this.scenes={},this.characters={},this.items={},this.enemies={},this.config={}}loadScenes(e){Array.isArray(e)?e.forEach(t=>{this.scenes[t.id]=t}):Object.assign(this.scenes,e)}loadCharacters(e){Array.isArray(e)?e.forEach(t=>{this.characters[t.id]=t}):Object.assign(this.characters,e)}loadItems(e){Array.isArray(e)?e.forEach(t=>{this.items[t.id]=t}):Object.assign(this.items,e)}loadEnemies(e){Array.isArray(e)?e.forEach(t=>{this.enemies[t.id]=t}):Object.assign(this.enemies,e)}loadConfig(e){this.config=e}getScene(e){return this.scenes[e]||null}getCharacter(e){return this.characters[e]||null}getItemData(e){return this.items[e]||null}getEnemy(e){return this.enemies[e]||null}evaluateCondition(e){switch(e.type){case"hasFlag":return this.state.hasFlag(e.flag)===(e.value!==!1);case"hasItem":return this.state.hasItem(e.item);case"statGreaterThan":return this.state.getStat(e.stat)>e.value;case"statLessThan":return this.state.getStat(e.stat)<e.value;case"goldGreaterThan":return this.state.state.gold>e.value;default:return console.warn(`ì•Œ ìˆ˜ ì—†ëŠ” ì¡°ê±´ íƒ€ì…: ${e.type}`),!0}}evaluateConditions(e){return!e||e.length===0?!0:e.every(t=>this.evaluateCondition(t))}applyEffect(e){switch(e.type){case"setFlag":this.state.setFlag(e.flag,e.value??!0);break;case"addItem":{const t=this.items[e.item];t&&this.state.addItem({...t,quantity:e.quantity||1});break}case"removeItem":this.state.removeItem(e.item,e.quantity||1);break;case"modifyStat":this.state.modifyStat(e.stat,e.value);break;case"setStat":this.state.setStat(e.stat,e.value);break;case"addExp":this.state.addExp(e.value);break;case"addGold":this.state.addGold(e.value);break;case"heal":this.state.modifyStat("hp",e.value);break;default:console.warn(`ì•Œ ìˆ˜ ì—†ëŠ” íš¨ê³¼ íƒ€ì…: ${e.type}`)}}applyEffects(e){!e||e.length===0||e.forEach(t=>this.applyEffect(t))}getAvailableChoices(e){return e.choices?e.choices.map(t=>({...t,available:this.evaluateConditions(t.conditions)})):[]}}class b{constructor(){this._timer=null,this._resolve=null,this._isTyping=!1,this._fullText="",this._targetElement=null,this.speed=30}get isTyping(){return this._isTyping}type(e,t){return this._isTyping&&this.skip(),this._fullText=t,this._targetElement=e,this._isTyping=!0,e.textContent="",new Promise(s=>{this._resolve=s;let i=0;this._timer=setInterval(()=>{i<t.length?(e.textContent+=t[i],i++):this._finish()},this.speed)})}skip(){this._isTyping&&(this._targetElement.textContent=this._fullText,this._finish())}_finish(){clearInterval(this._timer),this._timer=null,this._isTyping=!1,this._resolve&&(this._resolve(),this._resolve=null)}setSpeed(e){this.speed=e}destroy(){clearInterval(this._timer),this._timer=null,this._isTyping=!1,this._resolve=null}}class _{constructor(e){this.state=e,this.enemy=null,this.isActive=!1,this.turnCount=0,this.log=[],this._onUpdate=null,this._onEnd=null}start(e,t,s){this.enemy={...e,hp:e.hp,maxHp:e.hp},this.isActive=!0,this.turnCount=0,this.log=[],this._onUpdate=t,this._onEnd=s,this._addLog(`${this.enemy.name}ì´(ê°€) ë‚˜íƒ€ë‚¬ë‹¤!`),this._update()}playerAttack(){if(!this.isActive)return;const e=this.state.state.player,t=this._calculateDamage(e.attack,this.enemy.defense);if(this.enemy.hp=r(this.enemy.hp-t,0,this.enemy.maxHp),this._addLog(`${e.name}ì˜ ê³µê²©! ${this.enemy.name}ì—ê²Œ ${t} ë°ë¯¸ì§€!`),this.enemy.hp<=0){this._victory();return}this._enemyTurn()}playerSkill(){if(!this.isActive)return;const e=this.state.state.player,t=10;if(e.mp<t){this._addLog("MPê°€ ë¶€ì¡±í•˜ë‹¤!"),this._update();return}this.state.modifyStat("mp",-t);const s=this._calculateDamage(Math.floor(e.attack*1.5),this.enemy.defense);if(this.enemy.hp=r(this.enemy.hp-s,0,this.enemy.maxHp),this._addLog(`${e.name}ì˜ ê°•íƒ€! ${this.enemy.name}ì—ê²Œ ${s} ë°ë¯¸ì§€! (MP -${t})`),this.enemy.hp<=0){this._victory();return}this._enemyTurn()}playerUseItem(e){if(!this.isActive)return;const t=this.state.getItem(e);if(!t){this._addLog("ì•„ì´í…œì´ ì—†ë‹¤!"),this._update();return}if(t.effect){if(t.effect.type==="heal")this.state.modifyStat("hp",t.effect.value),this._addLog(`${t.name} ì‚¬ìš©! HPê°€ ${t.effect.value} íšŒë³µ!`);else if(t.effect.type==="mpRestore")this.state.modifyStat("mp",t.effect.value),this._addLog(`${t.name} ì‚¬ìš©! MPê°€ ${t.effect.value} íšŒë³µ!`);else if(t.effect.type==="damage"){const s=t.effect.value;this.enemy.hp=r(this.enemy.hp-s,0,this.enemy.maxHp),this._addLog(`${t.name} ì‚¬ìš©! ${this.enemy.name}ì—ê²Œ ${s} ë°ë¯¸ì§€!`)}}if(this.state.removeItem(e,1),this.enemy.hp<=0){this._victory();return}this._enemyTurn()}playerFlee(){if(!this.isActive)return;const e=this.state.state.player,t=r(40+(e.speed-this.enemy.speed)*5,20,90);m(1,100)<=t?(this._addLog("ë„ë§ì— ì„±ê³µí–ˆë‹¤!"),this.isActive=!1,this._update(),this._onEnd&&this._onEnd({victory:!1,fled:!0})):(this._addLog("ë„ë§ì— ì‹¤íŒ¨í–ˆë‹¤!"),this._enemyTurn())}_enemyTurn(){this.turnCount++;const e=this._calculateDamage(this.enemy.attack,this.state.state.player.defense);if(this.state.modifyStat("hp",-e),this._addLog(`${this.enemy.name}ì˜ ê³µê²©! ${e} ë°ë¯¸ì§€ë¥¼ ë°›ì•˜ë‹¤!`),this.state.state.player.hp<=0){this._defeat();return}this._update()}_calculateDamage(e,t){const s=Math.max(1,e-Math.floor(t/2)),i=m(-2,2);return Math.max(1,s+i)}_victory(){this._addLog(`${this.enemy.name}ì„(ë¥¼) ì“°ëŸ¬ëœ¨ë ¸ë‹¤!`),this.enemy.expReward&&(this.state.addExp(this.enemy.expReward),this._addLog(`ê²½í—˜ì¹˜ ${this.enemy.expReward} íšë“!`)),this.enemy.goldReward&&(this.state.addGold(this.enemy.goldReward),this._addLog(`ê³¨ë“œ ${this.enemy.goldReward} íšë“!`)),this.enemy.dropItem&&this._addLog(`${this.enemy.dropItem.name}ì„(ë¥¼) ì–»ì—ˆë‹¤!`),this.isActive=!1,this._update(),this._onEnd&&this._onEnd({victory:!0,enemy:this.enemy})}_defeat(){this._addLog("ì“°ëŸ¬ì¡Œë‹¤..."),this.isActive=!1,this._update(),this._onEnd&&this._onEnd({victory:!1,fled:!1})}_addLog(e){this.log.push(e)}_update(){this._onUpdate&&this._onUpdate({enemy:this.enemy,log:[...this.log],isActive:this.isActive,turnCount:this.turnCount})}getUsableItems(){return this.state.state.inventory.filter(e=>e.type==="consumable")}}const c="text_rpg_save_",h="text_rpg_autosave",d=3;class S{constructor(e){this.state=e}save(e){if(e<0||e>=d)return!1;const t={state:this.state.serialize(),timestamp:Date.now(),version:1};try{return localStorage.setItem(c+e,JSON.stringify(t)),!0}catch(s){return console.error("ì„¸ì´ë¸Œ ì‹¤íŒ¨:",s),!1}}load(e){if(e<0||e>=d)return!1;try{const t=localStorage.getItem(c+e);if(!t)return!1;const s=JSON.parse(t);return this.state.deserialize(s.state),!0}catch(t){return console.error("ë¡œë“œ ì‹¤íŒ¨:",t),!1}}autoSave(){const e={state:this.state.serialize(),timestamp:Date.now(),version:1};try{return localStorage.setItem(h,JSON.stringify(e)),!0}catch(t){return console.error("ì˜¤í† ì„¸ì´ë¸Œ ì‹¤íŒ¨:",t),!1}}loadAutoSave(){try{const e=localStorage.getItem(h);if(!e)return!1;const t=JSON.parse(e);return this.state.deserialize(t.state),!0}catch(e){return console.error("ì˜¤í† ì„¸ì´ë¸Œ ë¡œë“œ ì‹¤íŒ¨:",e),!1}}getSlotInfo(e){try{const t=localStorage.getItem(c+e);if(!t)return null;const s=JSON.parse(t),i=s.state.player;return{slot:e,timestamp:s.timestamp,date:new Date(s.timestamp).toLocaleString("ko-KR"),playerName:i.name,level:i.level,scene:s.state.currentScene}}catch{return null}}getAllSlotInfo(){const e=[];for(let t=0;t<d;t++)e.push(this.getSlotInfo(t));return e}hasAutoSave(){return localStorage.getItem(h)!==null}getAutoSaveInfo(){try{const e=localStorage.getItem(h);if(!e)return null;const t=JSON.parse(e);return{timestamp:t.timestamp,date:new Date(t.timestamp).toLocaleString("ko-KR"),playerName:t.state.player.name,level:t.state.player.level}}catch{return null}}deleteSlot(e){localStorage.removeItem(c+e)}deleteAutoSave(){localStorage.removeItem(h)}static get MAX_SLOTS(){return d}}class x{constructor(e,t){this.container=e,this.renderer=t,this._onNext=null,this._build(),this._bindEvents()}_build(){this.el=o("div","dialogue-box"),this.el.innerHTML=`
      <div class="dialogue-speaker"></div>
      <div class="dialogue-text"></div>
      <div class="dialogue-next">â–¼</div>
    `,this.speakerEl=this.el.querySelector(".dialogue-speaker"),this.textEl=this.el.querySelector(".dialogue-text"),this.nextEl=this.el.querySelector(".dialogue-next"),this.container.appendChild(this.el),this.hide()}_bindEvents(){const e=()=>{this.renderer.isTyping?this.renderer.skip():this._onNext&&this._onNext()};this.el.addEventListener("click",e),document.addEventListener("keydown",t=>{!this.el.classList.contains("hidden")&&(t.key===" "||t.key==="Enter")&&(t.preventDefault(),e())})}async showDialogue(e,t){this.show(),e?(this.speakerEl.textContent=e,this.speakerEl.classList.remove("hidden")):(this.speakerEl.textContent="",this.speakerEl.classList.add("hidden")),this.nextEl.classList.add("hidden"),await this.renderer.type(this.textEl,t),this.nextEl.classList.remove("hidden")}onNext(e){this._onNext=e}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}}class L{constructor(e){this.container=e,this.el=o("div","choice-buttons"),this.container.appendChild(this.el),this.hide()}showChoices(e){return this.el.innerHTML="",this.show(),new Promise(t=>{e.forEach((i,n)=>{const a=o("button","choice-btn");a.textContent=i.text,a.dataset.index=n,i.available?a.addEventListener("click",()=>{this.hide(),t(i)}):(a.classList.add("disabled"),a.disabled=!0,a.title="ì¡°ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤"),this.el.appendChild(a)});const s=i=>{const n=parseInt(i.key);if(n>=1&&n<=e.length){const a=e[n-1];a.available&&(document.removeEventListener("keydown",s),this.hide(),t(a))}};document.addEventListener("keydown",s)})}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden"),this.el.innerHTML=""}}class E{constructor(e,t){this.container=e,this.state=t,this._build(),this._subscribe(),this.update()}_build(){this.el=o("div","stats-panel"),this.el.innerHTML=`
      <div class="stat-row">
        <span class="stat-label">Lv.</span>
        <span class="stat-value level-value">1</span>
        <span class="stat-label gold-label">ğŸ’°</span>
        <span class="stat-value gold-value">0</span>
      </div>
      <div class="stat-bar-container">
        <div class="stat-bar hp-bar">
          <div class="stat-bar-fill hp-fill"></div>
          <span class="stat-bar-text hp-text">100/100</span>
        </div>
        <div class="stat-bar mp-bar">
          <div class="stat-bar-fill mp-fill"></div>
          <span class="stat-bar-text mp-text">50/50</span>
        </div>
      </div>
      <div class="stat-row exp-row">
        <div class="stat-bar exp-bar">
          <div class="stat-bar-fill exp-fill"></div>
          <span class="stat-bar-text exp-text">EXP 0/100</span>
        </div>
      </div>
    `,this.container.appendChild(this.el)}_subscribe(){this.state.on("statChanged",()=>this.update()),this.state.on("levelUp",()=>this.update()),this.state.on("goldChanged",()=>this.update()),this.state.on("expGained",()=>this.update()),this.state.on("stateLoaded",()=>this.update()),this.state.on("stateReset",()=>this.update())}update(){const e=this.state.state.player;this.el.querySelector(".level-value").textContent=e.level,this.el.querySelector(".gold-value").textContent=this.state.state.gold;const t=e.hp/e.maxHp*100;this.el.querySelector(".hp-fill").style.width=`${t}%`,this.el.querySelector(".hp-text").textContent=`HP ${e.hp}/${e.maxHp}`;const s=e.mp/e.maxMp*100;this.el.querySelector(".mp-fill").style.width=`${s}%`,this.el.querySelector(".mp-text").textContent=`MP ${e.mp}/${e.maxMp}`;const i=e.exp/e.expToNext*100;this.el.querySelector(".exp-fill").style.width=`${i}%`,this.el.querySelector(".exp-text").textContent=`EXP ${e.exp}/${e.expToNext}`}}class w{constructor(e){this.container=e,this._onAction=null,this._build(),this.hide()}_build(){this.el=o("div","combat-ui"),this.el.innerHTML=`
      <div class="combat-enemy">
        <div class="enemy-sprite"></div>
        <div class="enemy-name"></div>
        <div class="stat-bar enemy-hp-bar">
          <div class="stat-bar-fill enemy-hp-fill"></div>
          <span class="stat-bar-text enemy-hp-text"></span>
        </div>
      </div>
      <div class="combat-log"></div>
      <div class="combat-actions">
        <button class="combat-btn" data-action="attack">âš”ï¸ ê³µê²©</button>
        <button class="combat-btn" data-action="skill">âœ¨ ê°•íƒ€</button>
        <button class="combat-btn" data-action="item">ğŸ’ ì•„ì´í…œ</button>
        <button class="combat-btn" data-action="flee">ğŸƒ ë„ë§</button>
      </div>
      <div class="combat-items hidden"></div>
    `,this.enemySprite=this.el.querySelector(".enemy-sprite"),this.enemyNameEl=this.el.querySelector(".enemy-name"),this.enemyHpFill=this.el.querySelector(".enemy-hp-fill"),this.enemyHpText=this.el.querySelector(".enemy-hp-text"),this.logEl=this.el.querySelector(".combat-log"),this.actionsEl=this.el.querySelector(".combat-actions"),this.itemsEl=this.el.querySelector(".combat-items"),this.actionsEl.querySelectorAll(".combat-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.action;t==="item"?this._toggleItems():this._onAction&&this._onAction(t)})}),this.container.appendChild(this.el)}updateCombat(e){const{enemy:t,log:s,isActive:i}=e;if(t){this.enemyNameEl.textContent=t.name;const a=t.hp/t.maxHp*100;this.enemyHpFill.style.width=`${a}%`,this.enemyHpText.textContent=`${t.hp}/${t.maxHp}`,this.enemySprite.className=`enemy-sprite enemy-${t.sprite||"default"}`}this.logEl.innerHTML="",s.slice(-5).forEach(a=>{const f=o("div","combat-log-line",a);this.logEl.appendChild(f)}),this.logEl.scrollTop=this.logEl.scrollHeight,this.actionsEl.querySelectorAll(".combat-btn").forEach(a=>{a.disabled=!i})}showItems(e){if(this.itemsEl.innerHTML="",this.itemsEl.classList.remove("hidden"),e.length===0){this.itemsEl.innerHTML='<div class="no-items">ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´í…œì´ ì—†ë‹¤</div>',setTimeout(()=>this.itemsEl.classList.add("hidden"),1500);return}e.forEach(s=>{const i=o("button","item-btn");i.textContent=`${s.name} x${s.quantity}`,i.addEventListener("click",()=>{this.itemsEl.classList.add("hidden"),this._onAction&&this._onAction("useItem",s.id)}),this.itemsEl.appendChild(i)});const t=o("button","item-btn item-close","ì·¨ì†Œ");t.addEventListener("click",()=>this.itemsEl.classList.add("hidden")),this.itemsEl.appendChild(t)}_toggleItems(){this.itemsEl.classList.contains("hidden")?this._onAction&&this._onAction("showItems"):this.itemsEl.classList.add("hidden")}onAction(e){this._onAction=e}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden"),this.itemsEl.classList.add("hidden")}}class k{constructor(e,t){this.container=e,this.state=t,this._onUseItem=null,this._build(),this._subscribe(),this.hide()}_build(){this.el=o("div","inventory-panel"),this.el.innerHTML=`
      <div class="inventory-header">
        <span class="inventory-title">ğŸ’ ì¸ë²¤í† ë¦¬</span>
        <button class="inventory-close">âœ•</button>
      </div>
      <div class="inventory-list"></div>
    `,this.listEl=this.el.querySelector(".inventory-list"),this.el.querySelector(".inventory-close").addEventListener("click",()=>this.hide()),this.container.appendChild(this.el)}_subscribe(){this.state.on("inventoryChanged",()=>this.update()),this.state.on("stateLoaded",()=>this.update()),this.state.on("stateReset",()=>this.update())}update(){this.listEl.innerHTML="";const e=this.state.state.inventory;if(e.length===0){this.listEl.innerHTML='<div class="inventory-empty">ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤</div>';return}e.forEach(t=>{const s=o("div","inventory-item");if(s.innerHTML=`
        <div class="item-info">
          <span class="item-name">${t.name}</span>
          <span class="item-qty">x${t.quantity}</span>
        </div>
        <div class="item-desc">${t.description||""}</div>
      `,t.type==="consumable"){const i=o("button","item-use-btn","ì‚¬ìš©");i.addEventListener("click",()=>{this._onUseItem&&this._onUseItem(t.id)}),s.appendChild(i)}this.listEl.appendChild(s)})}onUseItem(e){this._onUseItem=e}toggle(){this.el.classList.contains("hidden")?(this.update(),this.show()):this.hide()}show(){this.update(),this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}}class C{constructor(e,t){this.container=e,this.saveSystem=t,this._onNewGame=null,this._onLoadGame=null,this._build()}_build(){this.el=o("div","title-screen"),this.el.innerHTML=`
      <div class="title-content">
        <div class="title-logo">
          <div class="title-text">TEXT RPG</div>
          <div class="title-subtitle">ì´ìƒí•œ ì•±ì´ ëœ¬ ë‚ </div>
        </div>
        <div class="title-menu">
          <button class="title-btn new-game-btn">â–¶ ìƒˆ ê²Œì„</button>
          <button class="title-btn continue-btn">â–¶ ì´ì–´í•˜ê¸°</button>
        </div>
        <div class="save-slots hidden"></div>
        <div class="title-footer">
          <span>Space / Enterë¡œ ì„ íƒ</span>
        </div>
      </div>
    `,this.menuEl=this.el.querySelector(".title-menu"),this.slotsEl=this.el.querySelector(".save-slots"),this.continueBtn=this.el.querySelector(".continue-btn"),this.el.querySelector(".new-game-btn").addEventListener("click",()=>{this._onNewGame&&this._onNewGame()}),this.continueBtn.addEventListener("click",()=>{this._showSaveSlots()}),this.container.appendChild(this.el)}_showSaveSlots(){this.slotsEl.innerHTML="",this.slotsEl.classList.remove("hidden");const e=this.saveSystem.getAutoSaveInfo();if(e){const i=o("button","slot-btn");i.innerHTML=`
        <span class="slot-label">ì˜¤í† ì„¸ì´ë¸Œ</span>
        <span class="slot-info">${e.playerName} Lv.${e.level} - ${e.date}</span>
      `,i.addEventListener("click",()=>{this.saveSystem.loadAutoSave(),this._onLoadGame&&this._onLoadGame()}),this.slotsEl.appendChild(i)}this.saveSystem.getAllSlotInfo().forEach((i,n)=>{const a=o("button","slot-btn");i?(a.innerHTML=`
          <span class="slot-label">ìŠ¬ë¡¯ ${n+1}</span>
          <span class="slot-info">${i.playerName} Lv.${i.level} - ${i.date}</span>
        `,a.addEventListener("click",()=>{this.saveSystem.load(n),this._onLoadGame&&this._onLoadGame()})):(a.innerHTML=`
          <span class="slot-label">ìŠ¬ë¡¯ ${n+1}</span>
          <span class="slot-info">â€” ë¹„ì–´ ìˆìŒ â€”</span>
        `,a.disabled=!0,a.classList.add("empty")),this.slotsEl.appendChild(a)});const s=o("button","slot-btn slot-back","â† ë’¤ë¡œ");s.addEventListener("click",()=>{this.slotsEl.classList.add("hidden")}),this.slotsEl.appendChild(s)}updateContinueButton(){const e=this.saveSystem.hasAutoSave(),t=this.saveSystem.getAllSlotInfo().some(s=>s!==null);this.continueBtn.disabled=!e&&!t,this.continueBtn.disabled&&this.continueBtn.classList.add("disabled")}onNewGame(e){this._onNewGame=e}onLoadGame(e){this._onLoadGame=e}show(){this.slotsEl.classList.add("hidden"),this.updateContinueButton(),this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}}class I{constructor(e,t){this.container=e,this.saveSystem=t,this._callbacks={},this._build(),this.hide()}_build(){this.el=o("div","menu-bar"),this.el.innerHTML=`
      <button class="menu-btn" data-action="inventory" title="ì¸ë²¤í† ë¦¬">ğŸ’</button>
      <button class="menu-btn" data-action="save" title="ì„¸ì´ë¸Œ">ğŸ’¾</button>
      <button class="menu-btn" data-action="title" title="íƒ€ì´í‹€ë¡œ">ğŸ </button>
    `,this.el.querySelectorAll(".menu-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.action;t==="save"?this._showSaveDialog():this._callbacks[t]&&this._callbacks[t]()})}),this.saveDialog=o("div","save-dialog hidden"),this.el.appendChild(this.saveDialog),this.container.appendChild(this.el)}_showSaveDialog(){this.saveDialog.innerHTML="",this.saveDialog.classList.remove("hidden");const e=o("div","save-dialog-header","ğŸ’¾ ì„¸ì´ë¸Œ");this.saveDialog.appendChild(e);for(let s=0;s<3;s++){const i=this.saveSystem.getSlotInfo(s),n=o("button","slot-btn");i?n.innerHTML=`
          <span class="slot-label">ìŠ¬ë¡¯ ${s+1}</span>
          <span class="slot-info">${i.playerName} Lv.${i.level} - ${i.date}</span>
        `:n.innerHTML=`
          <span class="slot-label">ìŠ¬ë¡¯ ${s+1}</span>
          <span class="slot-info">â€” ë¹„ì–´ ìˆìŒ â€”</span>
        `;const a=s;n.addEventListener("click",()=>{this.saveSystem.save(a),this.saveDialog.classList.add("hidden"),this._callbacks.onSave&&this._callbacks.onSave(a)}),this.saveDialog.appendChild(n)}const t=o("button","slot-btn slot-back","â† ë‹«ê¸°");t.addEventListener("click",()=>this.saveDialog.classList.add("hidden")),this.saveDialog.appendChild(t)}on(e,t){this._callbacks[e]=t}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}}const M=[{id:"intro_01",type:"dialogue",background:"street",speaker:null,text:"í‰ë²”í•œ ì›”ìš”ì¼ ì•„ì¹¨. ì¶œê·¼ê¸¸ ì§€í•˜ì²  ì•ˆì—ì„œ ë©í•˜ë‹ˆ í°ì„ ë³´ê³  ìˆë‹¤.",choices:[{text:"ê³„ì†...",nextScene:"intro_02"}]},{id:"intro_02",type:"dialogue",background:"subway",speaker:null,text:"ê°‘ìê¸° í°ì´ ì§„ë™í•œë‹¤. í™”ë©´ì— ë³¸ ì  ì—†ëŠ” ì•±ì´ ë–  ìˆë‹¤. 'ë‹¹ì‹ ì˜ ìš´ëª…ì„ ë°”ê¿€ ê¸°íšŒ â€” íƒ­í•˜ì—¬ ì‹œì‘'",choices:[{text:"ì•±ì„ íƒ­í•œë‹¤",effects:[{type:"setFlag",flag:"opened_app"},{type:"addItem",item:"mystery_phone"}],nextScene:"app_open"},{text:"ë¬´ì‹œí•˜ê³  ì¶œê·¼í•œë‹¤",effects:[{type:"setFlag",flag:"ignored_app"}],nextScene:"ignore_app"}]},{id:"app_open",type:"dialogue",background:"glitch",speaker:"???",text:"ì¶•í•˜í•©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì„ íƒë°›ì•˜ìŠµë‹ˆë‹¤. ì´ì œë¶€í„° ë‹¹ì‹ ì˜ í•˜ë£¨ëŠ”... ì¡°ê¸ˆ ë‹¬ë¼ì§ˆ ê²ë‹ˆë‹¤.",choices:[{text:"ë­... ë­ì•¼?",nextScene:"app_open_02"}]},{id:"app_open_02",type:"dialogue",background:"office",speaker:null,text:"ì •ì‹ ì„ ì°¨ë ¤ë³´ë‹ˆ ì–´ëŠìƒˆ íšŒì‚¬ì— ë„ì°©í•´ ìˆë‹¤. ë¨¸ë¦¬ê°€ ì•½ê°„ ì–´ì§€ëŸ½ë‹¤. ì±…ìƒ ìœ„ì— ì»¤í”¼ê°€ ë†“ì—¬ ìˆë‹¤.",effects:[{type:"addItem",item:"coffee"}],choices:[{text:"ì»¤í”¼ë¥¼ ë§ˆì‹ ë‹¤",effects:[{type:"modifyStat",stat:"hp",value:10},{type:"setFlag",flag:"drank_coffee"}],nextScene:"office_01"},{text:"ì¼ë¶€í„° ì‹œì‘í•œë‹¤",nextScene:"office_01"}]},{id:"ignore_app",type:"dialogue",background:"office",speaker:null,text:"ë³„ ê±° ì•„ë‹ˆê² ì§€. ë¬´ì‹œí•˜ê³  ì¶œê·¼í–ˆë‹¤. íšŒì‚¬ì— ë„ì°©í•˜ë‹ˆ ì´ëŒ€ë¦¬ê°€ ì†ì„ í”ë“ ë‹¤.",choices:[{text:"ì¸ì‚¬í•œë‹¤",nextScene:"colleague_chat"}]},{id:"colleague_chat",type:"dialogue",background:"office",speaker:"ì´ëŒ€ë¦¬",text:"ì•¼, ì˜¤ëŠ˜ ë¶€ì¥ë‹˜ ê¸°ë¶„ì´ ë³„ë¡œì•¼. ì¡°ì‹¬í•´. ì•„, ê·¸ë¦¬ê³  ì´ê±° ë¨¹ì–´.",effects:[{type:"addItem",item:"lunch_box"},{type:"setFlag",flag:"talked_to_colleague"}],choices:[{text:"ê³ ë§™ë‹¤! (ë„ì‹œë½ íšë“)",nextScene:"office_01"}]},{id:"office_01",type:"dialogue",background:"office",speaker:"ë°•ë¶€ì¥",text:"ê¹€ì§ì¥!! ë³´ê³ ì„œëŠ”?! ì•„ì§ë„ ì•ˆ í–ˆì–´?!",choices:[{text:"ì£„ì†¡í•©ë‹ˆë‹¤, ë°”ë¡œ í•˜ê² ìŠµë‹ˆë‹¤ (ìˆœì¢…)",effects:[{type:"modifyStat",stat:"hp",value:-5},{type:"setFlag",flag:"obeyed_boss"}],nextScene:"obey_ending"},{text:"...ì˜¤ëŠ˜ì€ ì°¸ì§€ ì•Šê² ë‹¤ (ëŒ€í•­)",conditions:[{type:"hasFlag",flag:"opened_app",value:!0}],effects:[{type:"setFlag",flag:"confronted_boss"}],nextScene:"boss_battle"},{text:"...ì˜¤ëŠ˜ì€ ì°¸ì§€ ì•Šê² ë‹¤ (ëŒ€í•­)",conditions:[{type:"hasFlag",flag:"ignored_app",value:!0}],nextScene:"boss_battle"}]},{id:"boss_battle",type:"combat",background:"office_battle",enemy:"angry_boss",introText:"ë°•ë¶€ì¥ì´ ë¶„ë…¸ë¡œ ì´ê¸€ì´ê¸€ íƒ€ì˜¤ë¥´ê³  ìˆë‹¤! ì„¤ì „ì´ ì‹œì‘ëœë‹¤!",victoryScene:"victory_ending",defeatScene:"defeat_ending",fleeScene:"obey_ending"},{id:"victory_ending",type:"ending",background:"office_sunset",speaker:null,text:"ë°•ë¶€ì¥ì„ ì„¤ì „ìœ¼ë¡œ ì´ê²¼ë‹¤! ì‚¬ë¬´ì‹¤ì´ ì¡°ìš©í•´ì¡Œë‹¤. ì´ëŒ€ë¦¬ê°€ ì—„ì§€ë¥¼ ì¹˜ì¼œì„¸ìš´ë‹¤. ì˜¤ëŠ˜ í•˜ë£¨ê°€ ë­”ê°€ ë‹¬ë¼ì§„ ê¸°ë¶„ì´ë‹¤.",endingType:"victory",choices:[{text:"ğŸ® íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°",nextScene:"__title__"}]},{id:"defeat_ending",type:"ending",background:"office_dark",speaker:null,text:"ë°•ë¶€ì¥ì˜ ì”ì†Œë¦¬ì— ê²°êµ­ ë¬´ë¦ì„ ê¿‡ì—ˆë‹¤... ì˜¤ëŠ˜ë„ ì•¼ê·¼ì´ë‹¤.",endingType:"defeat",choices:[{text:"ğŸ® íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°",nextScene:"__title__"}]},{id:"obey_ending",type:"ending",background:"office_night",speaker:null,text:"ìˆœìˆœíˆ ë³´ê³ ì„œë¥¼ ì‘ì„±í–ˆë‹¤. í‰ë²”í•œ í•˜ë£¨ê°€ ëë‚¬ë‹¤. í•˜ì§€ë§Œ í° ì† ì•±ì€ ì—¬ì „íˆ ê¹œë¹¡ì´ê³  ìˆë‹¤...",endingType:"normal",choices:[{text:"ğŸ® íƒ€ì´í‹€ë¡œ ëŒì•„ê°€ê¸°",nextScene:"__title__"}]}],T=[{id:"player",name:"ê¹€ì§ì¥",description:"í‰ë²”í•œ íšŒì‚¬ì›. ì˜¤ëŠ˜ë„ ì¶œê·¼ ì¤‘."},{id:"narrator",name:null,description:"ë‚˜ë ˆì´í„°"},{id:"boss",name:"ë°•ë¶€ì¥",description:"í•­ìƒ í™”ê°€ ë‚œ ë¶€ì¥ë‹˜"},{id:"colleague",name:"ì´ëŒ€ë¦¬",description:"ê°™ì€ íŒ€ ë™ë£Œ. ì˜ì™¸ë¡œ ë„ì›€ì´ ëœë‹¤."},{id:"mysterious_app",name:"???",description:"ì •ì²´ë¶ˆëª…ì˜ ì•± ì•Œë¦¼"}],$=[{id:"coffee",name:"ì»¤í”¼",description:"ë”°ëœ»í•œ ì•„ë©”ë¦¬ì¹´ë…¸. HPë¥¼ 30 íšŒë³µí•œë‹¤.",type:"consumable",effect:{type:"heal",value:30}},{id:"energy_drink",name:"ì—ë„ˆì§€ ë“œë§í¬",description:"MPë¥¼ 20 íšŒë³µí•œë‹¤.",type:"consumable",effect:{type:"mpRestore",value:20}},{id:"lunch_box",name:"ë„ì‹œë½",description:"ì—„ë§ˆê°€ ì‹¸ì¤€ ë„ì‹œë½. HPë¥¼ 50 íšŒë³µí•œë‹¤.",type:"consumable",effect:{type:"heal",value:50}},{id:"mystery_phone",name:"ì´ìƒí•œ ì•±",description:"í°ì— ê°‘ìê¸° ë‚˜íƒ€ë‚œ ì•±. ì •ì²´ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.",type:"key",effect:null},{id:"report",name:"ë³´ê³ ì„œ",description:"ê¸‰í•˜ê²Œ ë§Œë“  ë³´ê³ ì„œ. ê³µê²©ë ¥ì´ 5 ì˜¤ë¥¼ì§€ë„?",type:"equipment",effect:{type:"modifyStat",stat:"attack",value:5}}],A=[{id:"angry_boss",name:"ë¶„ë…¸í•œ ë°•ë¶€ì¥",sprite:"boss",hp:80,attack:12,defense:4,speed:3,expReward:50,goldReward:100,dropItem:{id:"coffee",name:"ì»¤í”¼",description:"ë”°ëœ»í•œ ì•„ë©”ë¦¬ì¹´ë…¸. HPë¥¼ 30 íšŒë³µí•œë‹¤.",type:"consumable",effect:{type:"heal",value:30}},skills:[]}],H="ì´ìƒí•œ ì•±ì´ ëœ¬ ë‚ ",N="0.1.0",q="intro_01",P=30,B={name:"ê¹€ì§ì¥",level:1,hp:100,maxHp:100,mp:50,maxMp:50,attack:10,defense:5,speed:5},p={title:H,version:N,startScene:q,typingSpeed:P,initialStats:B};class U{constructor(e){this.app=e,this.stateManager=new g,this.sceneManager=new v(this.stateManager),this.dialogueRenderer=new b,this.combatSystem=new _(this.stateManager),this.saveLoadSystem=new S(this.stateManager),this.sceneManager.loadScenes(M),this.sceneManager.loadCharacters(T),this.sceneManager.loadItems($),this.sceneManager.loadEnemies(A),this.sceneManager.loadConfig(p),this.dialogueRenderer.setSpeed(p.typingSpeed||30),this._buildUI(),this._bindEvents(),this.showTitle()}_buildUI(){this.bgEl=o("div","game-background"),this.app.appendChild(this.bgEl),this.gameContainer=o("div","game-container"),this.app.appendChild(this.gameContainer),this.titleScreen=new C(this.app,this.saveLoadSystem),this.statsPanel=new E(this.app,this.stateManager),this.menuBar=new I(this.app,this.saveLoadSystem),this.dialogueBox=new x(this.app,this.dialogueRenderer),this.choiceButtons=new L(this.app),this.combatUI=new w(this.app),this.inventoryPanel=new k(this.app,this.stateManager)}_bindEvents(){this.titleScreen.onNewGame(()=>this.startNewGame()),this.titleScreen.onLoadGame(()=>this.resumeGame()),this.menuBar.on("inventory",()=>this.inventoryPanel.toggle()),this.menuBar.on("title",()=>this.showTitle()),this.menuBar.on("onSave",e=>this.showToast(`ìŠ¬ë¡¯ ${e+1}ì— ì„¸ì´ë¸Œ ì™„ë£Œ!`,"success")),this.inventoryPanel.onUseItem(e=>{const t=this.stateManager.getItem(e);!t||t.type!=="consumable"||(t.effect&&this.sceneManager.applyEffect(t.effect),this.stateManager.removeItem(e,1),this.showToast(`${t.name} ì‚¬ìš©!`,"success"))}),this.combatUI.onAction((e,t)=>{switch(e){case"attack":this.combatSystem.playerAttack();break;case"skill":this.combatSystem.playerSkill();break;case"flee":this.combatSystem.playerFlee();break;case"showItems":this.combatUI.showItems(this.combatSystem.getUsableItems());break;case"useItem":this.combatSystem.playerUseItem(t);break}}),this.stateManager.on("levelUp",({level:e})=>{this.showToast(`ë ˆë²¨ ì—…! Lv.${e}`,"success"),this.app.classList.add("level-up-flash"),setTimeout(()=>this.app.classList.remove("level-up-flash"),800)})}showTitle(){this.combatUI.hide(),this.dialogueBox.hide(),this.choiceButtons.hide(),this.statsPanel.el.classList.add("hidden"),this.menuBar.hide(),this.inventoryPanel.hide(),this.bgEl.className="game-background",this.titleScreen.show()}startNewGame(){this.stateManager.reset();const e=p;if(e.initialStats){const t=this.stateManager.state.player;Object.assign(t,e.initialStats)}this.titleScreen.hide(),this.statsPanel.el.classList.remove("hidden"),this.statsPanel.update(),this.menuBar.show(),this.playScene(e.startScene)}resumeGame(){this.titleScreen.hide(),this.statsPanel.el.classList.remove("hidden"),this.statsPanel.update(),this.menuBar.show();const e=this.stateManager.state.currentScene;e?this.playScene(e):this.playScene(p.startScene)}async playScene(e){if(e==="__title__"){this.showTitle();return}const t=this.sceneManager.getScene(e);if(!t){console.error(`ì”¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${e}`);return}switch(this.stateManager.setCurrentScene(e),this.saveLoadSystem.autoSave(),this._setBackground(t.background),t.effects&&this.sceneManager.applyEffects(t.effects),t.type){case"dialogue":case"ending":await this._playDialogueScene(t);break;case"combat":await this._playCombatScene(t);break;default:await this._playDialogueScene(t)}}async _playDialogueScene(e){this.combatUI.hide();let t=e.speaker;t&&this.sceneManager.getCharacter(t)&&(t=this.sceneManager.getCharacter(t).name),await this.dialogueBox.showDialogue(t,e.text);const s=this.sceneManager.getAvailableChoices(e);if(s.length===0)return;if(s.length===1&&!s[0].conditions)return new Promise(n=>{this.dialogueBox.onNext(()=>{this.dialogueBox.onNext(null);const a=s[0];a.effects&&this.sceneManager.applyEffects(a.effects),n(),a.nextScene&&this.playScene(a.nextScene)})});this.dialogueBox.onNext(null);const i=await this.choiceButtons.showChoices(s);i.effects&&this.sceneManager.applyEffects(i.effects),i.nextScene&&this.playScene(i.nextScene)}async _playCombatScene(e){this.dialogueBox.hide(),this.choiceButtons.hide();const t=u(this.sceneManager.getEnemy(e.enemy));if(!t){console.error(`ì ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${e.enemy}`);return}return e.introText&&(await this.dialogueBox.showDialogue(null,e.introText),await y(500),this.dialogueBox.hide()),this.combatUI.show(),new Promise(s=>{this.combatSystem.start(t,i=>{this.combatUI.updateCombat(i)},async i=>{await y(1e3),this.combatUI.hide(),i.victory&&t.dropItem&&this.stateManager.addItem({...t.dropItem,quantity:1}),i.victory&&e.victoryScene?this.playScene(e.victoryScene):i.fled&&e.fleeScene?this.playScene(e.fleeScene):!i.victory&&e.defeatScene&&this.playScene(e.defeatScene),s()})})}_setBackground(e){e&&(this.bgEl.className=`game-background bg-${e}`,this.bgEl.classList.add("scene-transition"),setTimeout(()=>this.bgEl.classList.remove("scene-transition"),600))}showToast(e,t=""){const s=o("div",`toast ${t}`,e);this.app.appendChild(s),setTimeout(()=>s.remove(),2100)}}const D=document.querySelector("#app");new U(D);
